<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pseudosapiens - Suscripción</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="alternate icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>💭</text></svg>"
    <meta
      name="description"
      content="Recibe frases motivacionales personalizadas. Únete gratis y comienza tu viaje de inspiración diaria."
    />
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        margin: 0;
        padding: 0;
        display: grid;
        place-items: center;
        min-height: 100dvh;
      }
      .card {
        width: min(620px, 92vw);
        border: 1px solid #7773;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 6px 24px #00000010;
        background: #fff;
        color: #111;
      }
      @media (prefers-color-scheme: dark) {
        .card {
          background: #111;
          color: #eee;
          border-color: #fff2;
        }
        input,
        select,
        button {
          background: #1b1b1b;
          color: #fff;
          border-color: #fff2;
        }
      }
      h1 {
        margin: 0 0 8px;
        font-size: 1.7rem;
      }
      p {
        margin: 0 0 16px;
      }
      
      /* Accessibility helpers */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      
      /* WCAG 2.2 Focus Enhancement */
      input:focus,
      select:focus,
      button:focus {
        outline: 2px solid #6366f1;
        outline-offset: 2px;
      }
      
      /* High contrast focus for accessibility */
      @media (prefers-contrast: high) {
        input:focus,
        select:focus,
        button:focus {
          outline: 3px solid #000;
        }
      }
      
      /* Mobile optimizations */
      @media (max-width: 768px) {
        .card {
          padding: 20px 16px;
          margin: 16px;
        }
        
        input[type="email"],
        select,
        button {
          font-size: 16px; /* Prevent zoom on iOS */
          min-height: 52px; /* Larger touch targets on mobile */
        }
        
        form {
          gap: 16px; /* More spacing on mobile */
        }
        
        h1 {
          font-size: 1.5rem;
          line-height: 1.3;
        }
      }
      
      /* Google Sign-In Button Styling 2025 */
      .google-signin-container {
        margin: 24px 0;
        text-align: center;
      }
      
      /* Información de registro */
      .signup-info {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 1px solid #0369a1;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
        text-align: left;
      }
      
      .signup-info h2 {
        margin: 0 0 16px 0;
        font-size: 1.1rem;
        color: #0c4a6e;
        text-align: center;
      }
      
      .info-steps {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .step {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.9rem;
        line-height: 1.4;
      }
      
      .step-icon {
        font-size: 1.2rem;
        min-width: 24px;
      }
      
      .step-text {
        color: #1e40af;
      }
      
      .signup-disclaimer {
        font-size: 0.85rem;
        color: #6b7280;
        text-align: center;
        margin: 16px 0 0 0;
        line-height: 1.4;
      }
      
      .signup-disclaimer strong {
        color: #059669;
      }
      
      @media (prefers-color-scheme: dark) {
        .signup-info {
          background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
          border-color: #3b82f6;
        }
        
        .signup-info h2 {
          color: #60a5fa;
        }
        
        .step-text {
          color: #93c5fd;
        }
        
        .signup-disclaimer {
          color: #9ca3af;
        }
        
        .signup-disclaimer strong {
          color: #10b981;
        }
      }
      
      /* Reduce motion for users who prefer it */
      @media (prefers-reduced-motion: reduce) {
        * {
          transition: none !important;
          animation: none !important;
        }
      }
      form {
        display: grid;
        gap: 12px;
        margin-top: 12px;
      }
      label {
        font-size: 0.95rem;
      }
      input[type="email"],
      select {
        padding: 16px 16px;
        border-radius: 8px;
        border: 1px solid #7775;
        font-size: 1rem;
        min-height: 48px; /* WCAG 2.2 touch target size */
        box-sizing: border-box;
      }
      button {
        padding: 16px 20px;
        border-radius: 8px;
        border: 1px solid #7775;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        background: #6366f1;
        color: #fff;
        min-height: 48px; /* WCAG 2.2 touch target size */
        min-width: 48px;
      }
      small {
        opacity: 0.7;
      }
      
      /* Premium Options Styling */
      .premium-option {
        color: #9ca3af !important;
        font-style: italic;
        background: #f9fafb !important;
      }
      
      @media (prefers-color-scheme: dark) {
        .premium-option {
          color: #6b7280 !important;
          background: #1f2937 !important;
        }
      }
      
      /* Social Proof Styling */
      .social-proof {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 20px;
        border-radius: 12px;
        margin: 16px 0 20px 0;
        border-left: 4px solid #6366f1;
      }
      
      .testimonial {
        margin-bottom: 16px;
      }
      
      .testimonial blockquote {
        margin: 0 0 8px 0;
        font-style: italic;
        font-size: 0.95rem;
        line-height: 1.5;
        color: #374151;
      }
      
      .testimonial cite {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
      }
      
      .stats {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 0.9rem;
        color: #6b7280;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .stats .stat strong {
        color: #6366f1;
        font-weight: 600;
      }
      
      @media (prefers-color-scheme: dark) {
        .social-proof {
          background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
          border-left-color: #818cf8;
        }
        
        .testimonial blockquote {
          color: #d1d5db;
        }
        
        .testimonial cite {
          color: #9ca3af;
        }
        
        .stats {
          color: #9ca3af;
        }
        
        .stats .stat strong {
          color: #818cf8;
        }
      }
      
      /* Exit Intent Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: modalFadeIn 0.3s ease-out;
      }
      
      .modal.hidden {
        display: none;
      }
      
      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
      }
      
      .modal-content {
        position: relative;
        background: white;
        padding: 32px;
        border-radius: 16px;
        max-width: 400px;
        width: 90vw;
        text-align: center;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        animation: modalSlideIn 0.3s ease-out;
      }
      
      .modal-close {
        position: absolute;
        top: 12px;
        right: 16px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #9ca3af;
        padding: 4px;
        min-height: auto;
        min-width: auto;
      }
      
      .modal-close:hover {
        color: #374151;
      }
      
      .modal-content h2 {
        margin: 0 0 12px 0;
        font-size: 1.5rem;
        color: #dc2626;
      }
      
      .modal-content p {
        margin: 0 0 20px 0;
        color: #374151;
      }
      
      .mini-form {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 12px;
      }
      
      .mini-form input {
        padding: 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 16px;
      }
      
      .exit-cta {
        background: #dc2626 !important;
        color: white;
        border: none;
        padding: 14px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        font-size: 16px;
      }
      
      .exit-cta:hover {
        background: #b91c1c !important;
      }
      
      .modal-content small {
        color: #6b7280;
        font-size: 0.875rem;
      }
      
      .google-signin-exit {
        margin: 20px 0;
        text-align: center;
      }
      
      @keyframes modalFadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes modalSlideIn {
        from { 
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
        to { 
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      @media (prefers-color-scheme: dark) {
        .modal-content {
          background: #1f2937;
          color: #f9fafb;
        }
        
        .modal-content h2 {
          color: #fca5a5;
        }
        
        .modal-content p {
          color: #d1d5db;
        }
        
        .modal-close {
          color: #9ca3af;
        }
        
        .modal-close:hover {
          color: #f3f4f6;
        }
        
        .mini-form input {
          background: #374151;
          border-color: #4b5563;
          color: #f9fafb;
        }
        
        .modal-content small {
          color: #9ca3af;
        }
      }
      
      @media (prefers-reduced-motion: reduce) {
        .modal {
          animation: none;
        }
        
        .modal-content {
          animation: none;
        }
      }
    </style>
    <!-- Google Identity Services Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body>
    <main class="card">
      <h1>Frases que Transforman tu Día</h1>
      <div class="social-proof">
        <div class="testimonial">
          <blockquote>
            "Las frases de Steve Jobs me dieron la confianza para emprender. 
            Ahora dirijo mi propia startup. Recomiendo totalmente este servicio."
          </blockquote>
          <cite>— Carlos Mendoza, CEO Tech Startup</cite>
        </div>
        
        <div class="stats">
          <span class="stat">
            <strong id="subscriber-count">1,247</strong> personas ya suscritas
          </span>
          -
          <span class="stat">
            <strong id="emails-sent">89,420</strong> frases enviadas este mes
          </span>
        </div>
      </div>
      <p style="font-size: 0.9rem; opacity: 0.8;">
        Gratis - Sin spam - Cancela cuando quieras
      </p>

      <!-- Información de qué pasará -->
      <div class="signup-info">
        <h2>¿Qué pasará cuando te registres?</h2>
        <div class="info-steps">
          <div class="step">
            <span class="step-icon">📧</span>
            <span class="step-text">Recibirás <strong>3 frases por semana</strong> (Lunes, Miércoles, Viernes a las 8:00)</span>
          </div>
          <div class="step">
            <span class="step-icon">💼</span>
            <span class="step-text">Acceso a tu <strong>dashboard personal</strong> para gestionar preferencias</span>
          </div>
          <div class="step">
            <span class="step-icon">🔐</span>
            <span class="step-text">Registro seguro con Google - <strong>cancela cuando quieras</strong></span>
          </div>
        </div>
      </div>

      <!-- Google Sign-In Button Mejorado 2025 -->
      <div class="google-signin-container">
        <div id="g_id_signin"></div>
        <div id="google-loading" style="text-align: center; padding: 12px;">
          <p style="color: #6366f1;">🔄 Cargando Google Sign-In...</p>
        </div>
      </div>
      
      <p class="signup-disclaimer">
        Al registrarte, aceptas recibir frases motivacionales. Puedes cancelar en cualquier momento.
      </p>
    </main>

    <!-- Exit Intent Modal - Simplificado solo para Google -->
    <div id="exit-intent-modal" class="modal hidden" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
      <div class="modal-backdrop" onclick="closeExitModal()"></div>
      <div class="modal-content">
        <button class="modal-close" onclick="closeExitModal()" aria-label="Cerrar modal">&times;</button>
        
        <h2 id="modal-title">¡Espera! Una última oportunidad</h2>
        <p>Únete a <strong>más de 1,200 personas</strong> que ya mejoran su inglés profesional</p>
        
        <div class="google-signin-exit">
          <div id="g_id_signin_exit"></div>
        </div>
        
        <small>3 frases por semana • Registro con Google</small>
      </div>
    </div>

    <script>
      // Google Sign-In Handler
      function handleGoogleSignIn(response) {
        console.log('Google Sign-In successful:', response);
        
        // Handle both popup and redirect responses
        let credential = response.credential || response;
        
        // Check if we have a valid credential
        if (!credential || typeof credential !== 'string') {
          console.error('Invalid Google credential received:', response);
          alert('Error al iniciar sesión con Google. Intenta de nuevo.');
          return;
        }
        
        // Show loading state
        const googleContainer = document.querySelector('.google-signin-container');
        const originalContent = googleContainer.innerHTML;
        googleContainer.innerHTML = '<p style="color: #6366f1; font-weight: 500;">✨ Registrando tu cuenta...</p>';
        
        // Send credential to webhook
        fetch('https://elias-webhook.vercel.app/webhook/google-signin', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            credential: credential,
            frequency: 'weekly-3' // Default to free plan
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Save user data to localStorage for dashboard access
            const userData = {
              id: data.user.id,
              email: data.user.email,
              name: data.user.name,
              auth_method: data.user.auth_method,
              avatar_url: data.user.avatar_url || null
            };
            localStorage.setItem('pseudosapiens_user', JSON.stringify(userData));
            
            // Show success message before redirect
            googleContainer.innerHTML = '<p style="color: #059669; font-weight: 500;">🎉 ¡Registro exitoso! Redirigiendo...</p>';
            
            // Redirect to dashboard
            setTimeout(() => {
              window.location.href = '/dashboard';
            }, 1500);
          } else {
            throw new Error(data.error || 'Authentication failed');
          }
        })
        .catch(error => {
          console.error('Google Sign-In error:', error);
          googleContainer.innerHTML = '<p style="color: #dc2626; font-size: 0.9rem;">❌ Error al registrarse. <button onclick="location.reload()" style="color: #6366f1; text-decoration: underline; background: none; border: none; cursor: pointer;">Intentar de nuevo</button></p>';
        });
      }
      
      // Check if user is already authenticated and redirect to dashboard
      function checkAuthenticationAndRedirect() {
        const userData = localStorage.getItem('pseudosapiens_user');
        if (userData) {
          try {
            const user = JSON.parse(userData);
            if (user.email) {
              console.log('User already authenticated, redirecting to dashboard');
              window.location.href = '/dashboard';
              return true;
            }
          } catch (e) {
            // Invalid user data, remove it
            localStorage.removeItem('pseudosapiens_user');
          }
        }
        return false;
      }
      
      // Exit Intent Detection (simplificado)
      let exitIntentTriggered = false;
      let hasScrolled = false;
      
      function showExitIntentModal() {
        if (exitIntentTriggered) return;
        
        exitIntentTriggered = true;
        const modal = document.getElementById('exit-intent-modal');
        
        modal.classList.remove('hidden');
        modal.setAttribute('aria-hidden', 'false');
        
        // Render Google button in exit modal
        if (typeof google !== 'undefined' && google.accounts) {
          google.accounts.id.renderButton(
            document.getElementById('g_id_signin_exit'),
            {
              type: 'standard',
              shape: 'pill',
              theme: 'filled_blue',
              text: 'continue_with',
              size: 'large',
              width: 280
            }
          );
        }
        
        console.log('Exit intent modal shown');
      }
      
      function closeExitModal() {
        const modal = document.getElementById('exit-intent-modal');
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
      }
      
      // Simple exit intent triggers
      document.addEventListener('mouseleave', function(e) {
        if (e.clientY < 0 && !exitIntentTriggered && hasScrolled) {
          showExitIntentModal();
        }
      });
      
      // Track scroll for exit intent
      document.addEventListener('scroll', function() {
        hasScrolled = true;
      }, { passive: true });
      
      // Animate metrics on load for social proof
      function animateNumber(element, start, end, duration = 2000) {
        const startTime = performance.now();
        const range = end - start;
        
        function updateNumber(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // Easing function for smooth animation
          const easedProgress = progress * (2 - progress);
          const currentValue = Math.floor(start + (range * easedProgress));
          
          element.textContent = currentValue.toLocaleString();
          
          if (progress < 1) {
            requestAnimationFrame(updateNumber);
          }
        }
        
        requestAnimationFrame(updateNumber);
      }
      
      // Initialize metrics animation when page loads
      document.addEventListener('DOMContentLoaded', function() {
        const subscriberCount = document.getElementById('subscriber-count');
        const emailsSent = document.getElementById('emails-sent');
        
        // Add small random variations to make it feel live
        const baseSubscribers = 1247;
        const baseEmails = 89420;
        
        const todayVariation = new Date().getDate() % 7; // 0-6 variation based on day
        const currentSubscribers = baseSubscribers + todayVariation;
        const currentEmails = baseEmails + (todayVariation * 150);
        
        // Animate from lower numbers
        setTimeout(() => {
          animateNumber(subscriberCount, 1200, currentSubscribers, 1500);
          animateNumber(emailsSent, 85000, currentEmails, 2000);
        }, 500);
      });
      
      // Initialize Google Sign-In when page loads (Updated 2025 with FedCM)
      window.onload = function() {
        // Check authentication first
        if (checkAuthenticationAndRedirect()) {
          return; // Stop execution if redirecting
        }
        
        if (typeof google !== 'undefined' && google.accounts) {
          // Unified Google Sign-In configuration with FedCM enabled
          google.accounts.id.initialize({
            client_id: '970302400473-3umkhto0uhqs08p5njnhbm90in9lcp49.apps.googleusercontent.com',
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true,
            ux_mode: 'popup',
            use_fedcm_for_prompt: true // Enable FedCM for better UX
          });
          
          // Render the sign-in button with improved styling
          google.accounts.id.renderButton(
            document.getElementById('g_id_signin'),
            {
              type: 'standard',
              shape: 'pill',
              theme: 'filled_blue',
              text: 'continue_with',
              size: 'large',
              logo_alignment: 'left',
              width: 280,
              use_fedcm_for_button: true // Enable FedCM for button
            }
          );
          
          // Hide loading message
          const loadingDiv = document.getElementById('google-loading');
          if (loadingDiv) loadingDiv.style.display = 'none';
          
          console.log('Google Sign-In button rendered successfully with FedCM');
        } else {
          console.error('Google Identity Services not loaded');
          
          // Show fallback message if Google doesn't load
          const loadingDiv = document.getElementById('google-loading');
          if (loadingDiv) {
            loadingDiv.innerHTML = '<p style="color: #dc2626;">❌ Error cargando Google Sign-In. <button onclick="location.reload()" style="color: #6366f1; text-decoration: underline; background: none; border: none; cursor: pointer;">Recargar página</button></p>';
          }
        }
      };
    </script>
  </body>
</html>
