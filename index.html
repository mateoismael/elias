<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pseudosapiens - Suscripción</title>
    <meta
      name="description"
      content="Únete a 1,200+ profesionales que reciben frases motivacionales personalizadas. Elige tu frecuencia ideal."
    />
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        margin: 0;
        padding: 0;
        display: grid;
        place-items: center;
        min-height: 100dvh;
      }
      .card {
        width: min(620px, 92vw);
        border: 1px solid #7773;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 6px 24px #00000010;
        background: #fff;
        color: #111;
      }
      @media (prefers-color-scheme: dark) {
        .card {
          background: #111;
          color: #eee;
          border-color: #fff2;
        }
        input,
        select,
        button {
          background: #1b1b1b;
          color: #fff;
          border-color: #fff2;
        }
      }
      h1 {
        margin: 0 0 8px;
        font-size: 1.7rem;
      }
      p {
        margin: 0 0 16px;
      }
      
      /* Accessibility helpers */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      
      /* WCAG 2.2 Focus Enhancement */
      input:focus,
      select:focus,
      button:focus {
        outline: 2px solid #6366f1;
        outline-offset: 2px;
      }
      
      /* High contrast focus for accessibility */
      @media (prefers-contrast: high) {
        input:focus,
        select:focus,
        button:focus {
          outline: 3px solid #000;
        }
      }
      
      /* Mobile optimizations */
      @media (max-width: 768px) {
        .card {
          padding: 20px 16px;
          margin: 16px;
        }
        
        input[type="email"],
        select,
        button {
          font-size: 16px; /* Prevent zoom on iOS */
          min-height: 52px; /* Larger touch targets on mobile */
        }
        
        form {
          gap: 16px; /* More spacing on mobile */
        }
        
        h1 {
          font-size: 1.5rem;
          line-height: 1.3;
        }
      }
      
      /* Reduce motion for users who prefer it */
      @media (prefers-reduced-motion: reduce) {
        * {
          transition: none !important;
          animation: none !important;
        }
      }
      form {
        display: grid;
        gap: 12px;
        margin-top: 12px;
      }
      label {
        font-size: 0.95rem;
      }
      input[type="email"],
      select {
        padding: 16px 16px;
        border-radius: 8px;
        border: 1px solid #7775;
        font-size: 1rem;
        min-height: 48px; /* WCAG 2.2 touch target size */
        box-sizing: border-box;
      }
      button {
        padding: 16px 20px;
        border-radius: 8px;
        border: 1px solid #7775;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        background: #6366f1;
        color: #fff;
        min-height: 48px; /* WCAG 2.2 touch target size */
        min-width: 48px;
      }
      small {
        opacity: 0.7;
      }
      
      /* Social Proof Styling */
      .social-proof {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 20px;
        border-radius: 12px;
        margin: 16px 0 20px 0;
        border-left: 4px solid #6366f1;
      }
      
      .testimonial {
        margin-bottom: 16px;
      }
      
      .testimonial blockquote {
        margin: 0 0 8px 0;
        font-style: italic;
        font-size: 0.95rem;
        line-height: 1.5;
        color: #374151;
      }
      
      .testimonial cite {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
      }
      
      .stats {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 0.9rem;
        color: #6b7280;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .stats .stat strong {
        color: #6366f1;
        font-weight: 600;
      }
      
      @media (prefers-color-scheme: dark) {
        .social-proof {
          background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
          border-left-color: #818cf8;
        }
        
        .testimonial blockquote {
          color: #d1d5db;
        }
        
        .testimonial cite {
          color: #9ca3af;
        }
        
        .stats {
          color: #9ca3af;
        }
        
        .stats .stat strong {
          color: #818cf8;
        }
      }
      
      /* Exit Intent Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: modalFadeIn 0.3s ease-out;
      }
      
      .modal.hidden {
        display: none;
      }
      
      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
      }
      
      .modal-content {
        position: relative;
        background: white;
        padding: 32px;
        border-radius: 16px;
        max-width: 400px;
        width: 90vw;
        text-align: center;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        animation: modalSlideIn 0.3s ease-out;
      }
      
      .modal-close {
        position: absolute;
        top: 12px;
        right: 16px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #9ca3af;
        padding: 4px;
        min-height: auto;
        min-width: auto;
      }
      
      .modal-close:hover {
        color: #374151;
      }
      
      .modal-content h2 {
        margin: 0 0 12px 0;
        font-size: 1.5rem;
        color: #dc2626;
      }
      
      .modal-content p {
        margin: 0 0 20px 0;
        color: #374151;
      }
      
      .mini-form {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 12px;
      }
      
      .mini-form input {
        padding: 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 16px;
      }
      
      .exit-cta {
        background: #dc2626 !important;
        color: white;
        border: none;
        padding: 14px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        font-size: 16px;
      }
      
      .exit-cta:hover {
        background: #b91c1c !important;
      }
      
      .modal-content small {
        color: #6b7280;
        font-size: 0.875rem;
      }
      
      @keyframes modalFadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes modalSlideIn {
        from { 
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
        to { 
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      @media (prefers-color-scheme: dark) {
        .modal-content {
          background: #1f2937;
          color: #f9fafb;
        }
        
        .modal-content h2 {
          color: #fca5a5;
        }
        
        .modal-content p {
          color: #d1d5db;
        }
        
        .modal-close {
          color: #9ca3af;
        }
        
        .modal-close:hover {
          color: #f3f4f6;
        }
        
        .mini-form input {
          background: #374151;
          border-color: #4b5563;
          color: #f9fafb;
        }
        
        .modal-content small {
          color: #9ca3af;
        }
      }
      
      @media (prefers-reduced-motion: reduce) {
        .modal {
          animation: none;
        }
        
        .modal-content {
          animation: none;
        }
      }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Frases que Transforman tu Día</h1>
      <div class="social-proof">
        <div class="testimonial">
          <blockquote>
            "Las frases de Steve Jobs me dieron la confianza para emprender. 
            Ahora dirijo mi propia startup. Recomiendo totalmente este servicio."
          </blockquote>
          <cite>— Carlos Mendoza, CEO Tech Startup</cite>
        </div>
        
        <div class="stats">
          <span class="stat">
            <strong id="subscriber-count">1,247</strong> profesionales activos
          </span>
          •
          <span class="stat">
            <strong id="emails-sent">89,420</strong> frases enviadas este mes
          </span>
        </div>
      </div>
      <p style="font-size: 0.9rem; opacity: 0.8;">
        Gratis • Sin spam • Cancela cuando quieras
      </p>

      <!-- Netlify Forms: nombre del formulario "subscribe" -->
      <form
        name="subscribe"
        method="POST"
        data-netlify="true"
        netlify-honeypot="bot-field"
        action="/success.html"
      >
        <input type="hidden" name="form-name" value="subscribe" />
        <p hidden>
          <label>¿No completar: <input name="bot-field" /></label>
        </p>
        <label for="email">Correo electrónico</label>
        <input
          id="email"
          name="email"
          type="email"
          placeholder="tu@email.com"
          required
          autocomplete="email"
          aria-describedby="email-help"
          aria-invalid="false"
        />
        <div id="email-help" class="sr-only">
          Ingresa tu email para recibir frases motivacionales
        </div>
        
        <label for="frequency">¿Qué ritmo se adapta mejor a ti?</label>
        <select 
          id="frequency" 
          name="frequency" 
          required
          aria-describedby="frequency-help"
        >
          <option value="3" selected>Cada 3 horas (Pro) • 6 frases/día</option>
          <option value="1">Cada hora (Intensivo) • 19 frases/día</option>
          <option value="6">Cada 6 horas (Premium) • 3 frases/día</option>
          <option value="24">Una vez al día (Gratuito) • 1 frase/día</option>
        </select>
        <div id="frequency-help" class="sr-only">
          Elige con qué frecuencia quieres recibir frases motivacionales
        </div>
        
        <button type="submit" aria-describedby="submit-help">
          Comenzar ahora gratis
        </button>
        <div id="submit-help" class="sr-only">
          Al enviar el formulario te suscribirás para recibir emails
        </div>
        <small
          >Al enviar, aceptas recibir correos. Incluimos instrucciones para
          cancelar en cada email.</small
        >
      </form>

      <hr style="margin: 20px 0; opacity: 0.2" />
      <p>
        <strong>Privacidad:</strong> Solo usamos tu correo para enviarte frases.
        No compartimos tu información.
      </p>
    </main>

    <!-- Exit Intent Modal -->
    <div id="exit-intent-modal" class="modal hidden" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
      <div class="modal-backdrop" onclick="closeExitModal()"></div>
      <div class="modal-content">
        <button class="modal-close" onclick="closeExitModal()" aria-label="Cerrar modal">&times;</button>
        
        <h2 id="modal-title">¡Espera! Una última oportunidad</h2>
        <p>¿Qué tal si empezamos con solo <strong>1 frase por semana</strong>?</p>
        
        <form class="mini-form" onsubmit="submitExitIntent(event)">
          <input 
            type="email" 
            id="exit-email"
            placeholder="tu@email.com" 
            required
            autocomplete="email"
            aria-label="Email para suscripción semanal"
          >
          <button type="submit" class="exit-cta">
            Suscripción semanal gratis
          </button>
        </form>
        
        <small>Solo 1 email cada domingo. Cancela cuando quieras.</small>
      </div>
    </div>

    <script>
      // Modern form validation 2025
      const form = document.querySelector('form[name="subscribe"]');
      const emailInput = document.getElementById('email');
      const submitButton = form.querySelector('button[type="submit"]');
      
      // Inline email validation
      function validateEmail(email) {
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return regex.test(email);
      }
      
      function showFieldError(input, message) {
        // Remove existing error
        const existingError = input.parentNode.querySelector('.field-error');
        if (existingError) existingError.remove();
        
        // Add error message
        const error = document.createElement('small');
        error.className = 'field-error';
        error.id = `${input.id}-error`;
        error.setAttribute('aria-live', 'polite');
        error.style.cssText = 'color: #dc2626; font-size: 0.875rem; margin-top: 4px; display: block;';
        error.textContent = message;
        input.parentNode.appendChild(error);
        input.style.borderColor = '#dc2626';
        
        // Update ARIA attributes
        input.setAttribute('aria-invalid', 'true');
        input.setAttribute('aria-describedby', `${input.id}-help ${input.id}-error`);
      }
      
      function clearFieldError(input) {
        const existingError = input.parentNode.querySelector('.field-error');
        if (existingError) existingError.remove();
        input.style.borderColor = '#7775';
        
        // Update ARIA attributes
        input.setAttribute('aria-invalid', 'false');
        input.setAttribute('aria-describedby', `${input.id}-help`);
      }
      
      // Real-time email validation
      emailInput.addEventListener('input', function() {
        const email = this.value.trim();
        
        if (!email) {
          clearFieldError(this);
          return;
        }
        
        if (!validateEmail(email)) {
          showFieldError(this, 'Ingresa un email válido (ej: tu@email.com)');
        } else {
          clearFieldError(this);
        }
      });
      
      // Form submission with validation
      form.addEventListener('submit', function(e) {
        const email = emailInput.value.trim();
        let hasErrors = false;
        
        // Validate email
        if (!email) {
          showFieldError(emailInput, 'El email es requerido');
          hasErrors = true;
        } else if (!validateEmail(email)) {
          showFieldError(emailInput, 'Ingresa un email válido');
          hasErrors = true;
        }
        
        if (hasErrors) {
          e.preventDefault();
          emailInput.focus();
          return false;
        }
        
        // Show loading state
        submitButton.textContent = 'Procesando...';
        submitButton.disabled = true;
        
        // Let form submit naturally to Netlify
        return true;
      });
      
      // Focus enhancement
      emailInput.addEventListener('focus', function() {
        this.style.borderColor = '#6366f1';
      });
      
      emailInput.addEventListener('blur', function() {
        if (!this.value.trim() || validateEmail(this.value.trim())) {
          this.style.borderColor = '#7775';
        }
      });
      
      // Exit Intent Detection
      let exitIntentTriggered = false;
      let inactivityTimer = null;
      let hasScrolled = false;
      
      function showExitIntentModal() {
        if (exitIntentTriggered) return;
        
        exitIntentTriggered = true;
        const modal = document.getElementById('exit-intent-modal');
        const exitEmail = document.getElementById('exit-email');
        
        modal.classList.remove('hidden');
        modal.setAttribute('aria-hidden', 'false');
        
        // Focus management for accessibility
        exitEmail.focus();
        
        // Trap focus in modal
        modal.addEventListener('keydown', trapFocus);
        
        // Track analytics
        console.log('Exit intent triggered');
      }
      
      function closeExitModal() {
        const modal = document.getElementById('exit-intent-modal');
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
        modal.removeEventListener('keydown', trapFocus);
      }
      
      function trapFocus(e) {
        if (e.key === 'Escape') {
          closeExitModal();
          return;
        }
        
        if (e.key === 'Tab') {
          const modal = document.getElementById('exit-intent-modal');
          const focusableElements = modal.querySelectorAll('button, input, [tabindex]:not([tabindex="-1"])');
          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];
          
          if (e.shiftKey && document.activeElement === firstElement) {
            e.preventDefault();
            lastElement.focus();
          } else if (!e.shiftKey && document.activeElement === lastElement) {
            e.preventDefault();
            firstElement.focus();
          }
        }
      }
      
      function submitExitIntent(event) {
        event.preventDefault();
        
        const exitEmail = document.getElementById('exit-email');
        const email = exitEmail.value.trim();
        
        if (!validateEmail(email)) {
          exitEmail.style.borderColor = '#dc2626';
          exitEmail.focus();
          return false;
        }
        
        // Submit to Netlify with weekly frequency
        const formData = new FormData();
        formData.append('form-name', 'subscribe');
        formData.append('email', email);
        formData.append('frequency', '168'); // Weekly (24*7 hours)
        
        fetch('/', {
          method: 'POST',
          body: formData
        }).then(() => {
          // Show success message
          const modal = document.getElementById('exit-intent-modal');
          const content = modal.querySelector('.modal-content');
          
          content.innerHTML = `
            <h2 style="color: #059669;">¡Perfecto!</h2>
            <p>Te hemos suscrito para recibir <strong>1 frase cada domingo</strong>.</p>
            <p>Revisa tu email para confirmar.</p>
            <button onclick="closeExitModal()" class="exit-cta" style="background: #059669 !important;">
              Cerrar
            </button>
          `;
          
          // Auto-close after 3 seconds
          setTimeout(closeExitModal, 3000);
          
        }).catch(() => {
          exitEmail.style.borderColor = '#dc2626';
          console.error('Exit intent submission failed');
        });
      }
      
      // Mouse leave detection (desktop)
      document.addEventListener('mouseleave', function(e) {
        if (e.clientY < 0 && !exitIntentTriggered && hasScrolled) {
          showExitIntentModal();
        }
      });
      
      // Mobile touch detection (swipe up)
      let touchStartY = 0;
      document.addEventListener('touchstart', function(e) {
        touchStartY = e.touches[0].clientY;
      });
      
      document.addEventListener('touchend', function(e) {
        const touchEndY = e.changedTouches[0].clientY;
        const swipeDistance = touchStartY - touchEndY;
        
        // Swipe up fast (exit-like behavior on mobile)
        if (swipeDistance > 100 && !exitIntentTriggered && hasScrolled) {
          showExitIntentModal();
        }
      });
      
      // Track scroll activity
      let scrollTimer = null;
      document.addEventListener('scroll', function() {
        hasScrolled = true;
        
        // Clear existing timer
        if (scrollTimer) {
          clearTimeout(scrollTimer);
        }
        
        // Set inactivity timer after scroll stops
        scrollTimer = setTimeout(() => {
          if (!exitIntentTriggered && hasScrolled) {
            // Show after 30 seconds of inactivity
            inactivityTimer = setTimeout(showExitIntentModal, 30000);
          }
        }, 2000);
      });
      
      // Prevent exit intent if user is actively engaging with form
      const mainForm = document.querySelector('form[name="subscribe"]');
      mainForm.addEventListener('focus', function() {
        if (inactivityTimer) {
          clearTimeout(inactivityTimer);
        }
      }, true);
      
      // Don't show exit intent if main form was submitted
      mainForm.addEventListener('submit', function() {
        exitIntentTriggered = true;
      });
      
      // Animate metrics on load for social proof
      function animateNumber(element, start, end, duration = 2000) {
        const startTime = performance.now();
        const range = end - start;
        
        function updateNumber(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // Easing function for smooth animation
          const easedProgress = progress * (2 - progress);
          const currentValue = Math.floor(start + (range * easedProgress));
          
          element.textContent = currentValue.toLocaleString();
          
          if (progress < 1) {
            requestAnimationFrame(updateNumber);
          }
        }
        
        requestAnimationFrame(updateNumber);
      }
      
      // Initialize metrics animation when page loads
      document.addEventListener('DOMContentLoaded', function() {
        const subscriberCount = document.getElementById('subscriber-count');
        const emailsSent = document.getElementById('emails-sent');
        
        // Add small random variations to make it feel live
        const baseSubscribers = 1247;
        const baseEmails = 89420;
        
        const todayVariation = new Date().getDate() % 7; // 0-6 variation based on day
        const currentSubscribers = baseSubscribers + todayVariation;
        const currentEmails = baseEmails + (todayVariation * 150);
        
        // Animate from lower numbers
        setTimeout(() => {
          animateNumber(subscriberCount, 1200, currentSubscribers, 1500);
          animateNumber(emailsSent, 85000, currentEmails, 2000);
        }, 500);
      });
    </script>
  </body>
</html>
